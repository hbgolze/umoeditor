{% load static %}

{% load ratings %}

<div class="list-group-item" id="problem-card_{{p.pk}}">
  <div class="container">
    <div class="row">
  <div class="col-6 col-sm-5 col-md-4 col-lg-3"><br>
    <p>{{p.label}}</p>
    
    <p>Author: {{p.current_version.author_name}}</p>
    <!--  <label for="difficulty_{{p.pk}}"></label>-->
    <form>
      <label for="difficulty_{{p.pk}}">Difficulty:</label>
      <select id="difficulty_{{p.pk}}" class="diff-select form-control form-control-sm mb-1">
	<option value="1" {% if p.current_version.difficulty == "1" %}selected{% endif %}>1
        </option>
        <option value="2" {% if p.current_version.difficulty == "2" %}selected{% endif %}>2
        </option>
        <option value="3" {% if p.current_version.difficulty == "3" %}selected{% endif %}>3
        </option>
        <option value="4" {% if p.current_version.difficulty == "4" %}selected{% endif %}>4
        </option>
        <option value="5" {% if p.current_version.difficulty == "5" %}selected{% endif %}>5
        </option>
        <option value="6" {% if p.current_version.difficulty == "6" %}selected{% endif %}>6
        </option>
      </select>
      <!--    <label for="status_{{p.pk}}">Move To:</label>      -->
      <label for="status_{{p.pk}}">Move To:</label>
      <select id="status_{{p.pk}}" class="status-select form-control form-control-sm mb-1">
        <option value="NP" {% if p.problem_status == "NP" %}selected{% endif %}>New Problem
        </option>
        <option value="PN" {% if p.problem_status == "PN" %}selected{% endif %}>Propose for Current Year
        </option>
        <option value="PL" {% if p.problem_status == "PL" %}selected{% endif %}>Propose for Future Year
        </option>
        <option value="MI" {% if p.problem_status == "MI" %}selected{% endif %}>Has Potential
        </option>
        <option value="MJ" {% if p.problem_status == "MJ" %}selected{% endif %}>Needs Major Revision
        </option>
        <option value="TR" {% if p.problem_status == "TR" %}selected{% endif %}>Trash
        </option>
      </select>
      <label for="topic_{{p.pk}}">Change Topic:</label>
      <select id="topic_{{p.pk}}" class="change-topic form-control form-control-sm mb-1">
        <option value="Algebra" {% if p.topic == "Algebra" %}selected{% endif %}>Algebra
        </option>
        <option value="Combinatorics" {% if p.topic == "Combinatorics" %}selected{% endif %}>Combinatorics
        </option>
        <option value="Games" {% if p.topic == "Games" %}selected{% endif %}>Games
        </option>
        <option value="Geometry" {% if p.topic == "Geometry" %}selected{% endif %}>Geometry
        </option>
        <option value="Number Theory" {% if p.topic == "Number Theory" %}selected{% endif %}>Number Theory
        </option>
        <option value="Other" {% if p.topic == "Other" %}selected{% endif %}>Other
        </option>
      </select>
      <label for="addtolist_{{p.pk}}">Add To List:</label>
      <select id="addtolist_{{p.pk}}" class="add-to-list form-control form-control-sm mb-2">
	<option value="" disabled selected>Choose a List</option>
	{% for mklist in mklists %}
	<option value="{{mklist.pk}}">{{mklist.name}}</option>
	{% endfor %}
      </select>
    </form>
    
    <p><a class="btn btn-primary btn-sm mt-2" name="det_{{p.pk}}" href="/detailedview/{{p.pk}}">Edit Details</a>
    </p>
    <p>{{p.versions.count}} Version{% if p.versions.count > 1%}s{% endif %}</p>

    <p>
      <div class="btn-group btn-group-sm mr-2 mb-1 mt-1" role="group" aria-label="Solution options">
	<button class="btn btn-sm btn-secondary solution-link" id="solution-link_{{p.pk}}">Solutions ({{p.current_version.solutions.count}})</button>
	<button class="btn btn-sm btn-primary new-solution-link" id="new-sol_{{p.pk}}" title="Add New Solution"><span class="fa fa-plus"></span></button>
      </div>
    </p>
    <label>Rating:</label>
    {% if request.user in p.current_version.authors.all %}
    <p>{% ratings p.current_version 20 20 'read_only' %}</p>
    {% else %}
    <p>{% ratings p.current_version 20 20 %}</p>
    {% endif %}
    
    {% if mocklist %}
    <p>
      <button type="submit" id="remove_{{mocklist.pk}}_{{p.pk}}" class="btn btn-primary btn-sm remove-from-mocklist">Remove from List</button>
    </p>
    {% endif %}
  </div>

  <div class="col-6 col-sm-7 col-md-8 col-lg-9"><br>
    <table width="100%">
      <tr>
	<td>
	  <p>
	    {% autoescape off %}{{p.current_version.problem_latex|linebreaks}} {% endautoescape %}
	  </p>
	</td>
      </tr>
      <tr>
	<td>
	  <a href="javascript:ReverseDisplay('comment_{{p.pk}}')">
	    Click to show/hide comments ({{p.comments.count}}).
	  </a>
	  
	  <div id="comment_{{p.pk}}" style="display:none">
	    {% for c in p.comments.all %}
	    <div class="media">
	      <div class="media-body">
		<div class="d-flex flex-row justify-content-between">
		  <div class="p-2 flex-grow-1">
		    <h3 class="mt-0 media-heading user_name">{{c.author_name}}</h3>
		  </div>
		  <div class="p-2 float-right">
		    <small>{{c.created_date}}</small>
		  </div>
		</div>
		<div class="d-flex flex-row">
		  <div class="p-2">
		    {{c.comment_text|linebreaks}}
		  </div>
		</div>
	      </div>
	    </div>
	    {% endfor %}
	  </div>
	  
	</td>
      </tr>
      <tr>
	<td>
	  <p class="pull-right"><small>[{{p.label}}], Proposed on {{p.created_date}}</small></p>
	</td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>
